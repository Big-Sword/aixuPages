<!DOCTYPE HTML>
<html>

	<head>
		<title>爱 煦 - 产品明细</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script type="application/x-javascript">
			addEventListener("load", function() {
				setTimeout(hideURLbar, 0);
			}, false);

			function hideURLbar() {
				window.scrollTo(0, 1);
			}
		</script>
		<link href="css/bootstrap.min.css" rel='stylesheet' type='text/css' />
		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
		<!-- Custom Theme files -->
		<link href="css/style.css" rel='stylesheet' type='text/css' />
		<!-- Custom Theme files -->
		<!--webfont-->
		<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
		<!-- start menu -->
		<link href="css/megamenu.css" rel="stylesheet" type="text/css" media="all" />
		<link href="css/font-awesome.min.css" rel="stylesheet">
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">
		<link href="css/flexslider.css" rel="stylesheet">
		<link href="css/templatemo-style.css" rel="stylesheet">

		<script type="text/javascript" src="js/megamenu.js"></script>
		<script>
			$(document).ready(function() {
				$(".megamenu").megamenu();
			});
		</script>
		<script src="js/jquery.easydropdown.js"></script>
		<script src="js/easyResponsiveTabs.js" type="text/javascript"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				$('#horizontalTab').easyResponsiveTabs({
					type: 'default', //Types: default, vertical, accordion           
					width: 'auto', //auto or any width like 600px
					fit: true // 100% fit in a container
				});
			});
		</script>
		<script src="js/simpleCart.min.js">
		</script>
	</head>

	<body>
		<!-- Header -->
		<div class="tm-header">
			<div class="container">
				<div class="row">
					<div class="col-lg-6 col-md-4 col-sm-3 tm-site-name-container">
						<a href="#" class="tm-site-name">爱 煦</a>
					</div>
					<div class="col-lg-6 col-md-8 col-sm-9">
						<div class="mobile-menu-icon">
							<i class="fa fa-bars"></i>
						</div>
						<nav class="tm-nav">
							<ul>
								<li>
									<a href="index.html">首页</a>
								</li>
								<!-- <li><a href="about.html">About</a></li> -->
								<li>
									<a href="product.html" class="active">产品中心</a>
								</li>
								<li>
									<a href="about.html">关于我们</a>
								</li>
								<li>
									<a href="#" id="loginhref"><span class="glyphicon glyphicon-user"></span> <span id="loginName"></span> <span class="caret"></span></a>
									<ul class="dropdown-menu" id="loginlogout" style="left: auto;width: 102px;">
										<li>
											<a href="cart.html"><span class="glyphicon glyphicon-shopping-cart">我的购物车</span> </a>
										</li>
										<li>
											<a href="order.html"><span class="glyphicon glyphicon-ok-circle"></span> 我的订单</a>
										</li>
										<li>
											<a href="uppasswd.html" ><span class="glyphicon glyphicon-edit"></span> 修改密码</a>
										</li>
										<li>
											<a href="#" onclick="logout()"><span class="glyphicon glyphicon-log-out"></span> 登出</a>
										</li>
									</ul>
								</li>
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</div>
		<div class="men">
			<div class="container">
				<div class="col-md-9 single_top">
					<div class="single_left">
						<div class="labout span_1_of_a1">
							<div class="flexslider">
								<ul class="slides" id="picUrls">

								</ul>
							</div>
							<div class="clearfix"></div>
						</div>
						<div class="cont1 span_2_of_a1 simpleCart_shelfItem">
							<input type="hidden" id="rPrice" />
							<h1 id="pName"></h1>
							<div class="price_single">
								<span class="amount item_price actual" id="price"></span>
							</div>
							<h2 class="quick">产品描述:</h2>
							<p class="quick_desc" id="content"></p>

							<ul class="size">
								<h3>型号</h3>
								<li>
									<a href="#" id="mType"></a>
								</li>

							</ul>
							<ul class="size">
								<h3>色号</h3>
								<li>
									<a href="#" id="cType"></a>
								</li>

							</ul>
							<div class="quantity_box">
								<ul class="product-qty">
									<span>数量:</span>
									<button type="button" onclick="abdce()" class="btn">-</button>
									<input id="shuliang" class="control-label" size="4" onkeyup="value=value.replace(/[^\d.]/g,'')" value="1" onChange="abc()" />
									<button type="button" onclick="abdc()" class="btn">+</button>
								</ul>

								<div class="clearfix"></div>
							</div>
							<div class="quantity_box">
								<ul class="product-qty">
									<span id="ccc"></span>
								</ul>

								<div class="clearfix"></div>
							</div>
							<a href="#" onclick="addCart();" class="btn btn-primary btn-normal btn-inline btn_form button item_add item_1">添加至购物车</a>
						</div>
						<div class="clearfix"> </div>
					</div>

				</div>
				<div class="col-md-3 tabs">
					<h3 class="m_1">相关产品</h3>
					<div id="xgcp">
					</div>
				</div>
				<div class="clearfix"> </div>
			</div>
		</div>
		<footer class="tm-black-bg">
			<div class="container">
				<div class="row">
				<p class="tm-copyright-text">Copyright &copy; 2017 爱煦 &nbsp; All Rights Reserved &nbsp;<a href="http://www.miitbeian.gov.cn/" target="_blank">沪ICP备17000540号</a>
					</p>
				</div>
			</div>
		</footer>
		<!-- FlexSlider -->
		<script defer src="js/jquery.flexslider.js"></script>
		<script defer src="js2/bigDecimal.js"></script>

		<script type="text/javascript" src="js/moment.js"></script>
		<!-- moment.js -->
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<!-- bootstrap js -->
		<script type="text/javascript" src="js/bootstrap-datetimepicker.min.js"></script>
		<!-- bootstrap date time picker js, http://eonasdan.github.io/bootstrap-datetimepicker/ -->
		<script type="text/javascript" src="js/templatemo-script.js"></script>

		<link rel="stylesheet" href="css/flexslider.css" type="text/css" media="screen" />
		<script>
			//var baseUrl = "http://localhost:8080/";
			 var baseUrl = "http://139.196.12.123:8080/";
			var storage = window.localStorage;
			var token = storage.shopperToken;
			var username = storage.shopperName;
			var productId = storage.productId;
			if(token == undefined || token == "null") {
				alert("您还未登录");
				location.href = "login.html";
				$("#loginhref").attr("href", "login.html"); //这里设置链接地址
				$("#loginhref").html("登录"); //这里设置显示的内容
				$("#loginlogout").hide();
			} else {
				//class="dropdown-toggle" data-toggle="dropdown"
				$("#loginhref").attr("class", "dropdown-toggle"); //这里设置链接
				$("#loginhref").attr("data-toggle", "dropdown"); //这里设置链接
				$("#loginName").html(storage.shopperName);
			}
			$(function() {
				$.ajax({
					"dataType": 'json',
					"type": "get",
					"url": baseUrl + "product/get/" + productId,
					contentType: "application/json",
					async: false,
					headers: {
						"x-token": token,
						"type": 1
					},
					"data": {},
					"success": function(data) {
						if(data.code == 200) {
							$("#pName").html(data.data.name);
							$("#mType").html(data.data.modelType);
							$("#cType").html(data.data.colourType);
							$("#content").html(data.data.content);
							$("#ccc").html("总价: " + data.data.price + "元");
							$("#rPrice").val(data.data.price);
							$("#price").html("单价: " + data.data.price + "元");
							var d = data.data.picUrl.split("~");
							$.each(d, function(i, r) {
								var html = "<li data-thumb='/aixuManager/productImg/" + r + "'><img src='/aixuManager/productImg/" + r + "' /></li>";
								$("#picUrls").append(html);
							});

						} else {
							alert(data.msg);
						}
					},
					"error": function(resp) {
						if(resp.status == 500) {
							alert("服务器异常");
						} else {
							logout();
						}
					}
				});
			});

			$(function() {
				$.ajax({
					"dataType": 'json',
					"type": "get",
					"url": baseUrl + "product/common/recommend/" + productId + "/4",
					contentType: "application/json",
					async: false,
					headers: {
						"x-token": token,
						"type": 1
					},
					"data": {},
					"success": function(data) {
						if(data.code == 200) {

							$.each(data.data, function(index, item) {

								var html = "<ul class='product'><li class='product_img'><img src='/aixuManager/productImg/" + item.picUrl.split("~")[0] + "' class='img-responsive' alt='' /></li><li class='product_desc'><h4><a href='#'>" + item.name + "</a></h4><p class='single_price'>单价: " + item.price + "元</p><a href='#' onclick='addCart2(" + item.id + ");' class='link-cart'>添加至购物车</a></li><div class='clearfix'> </div></ul>";

								$("#xgcp").append(html);
							});
						}
					},
					"error": function(resp) {}
				});
			});

			function logout() {
				storage.removeItem("shopperToken");
				storage.removeItem("shopperName");
				location.href = "index.html";
			}

			function addCart() {
				var sl = $('#shuliang').val();
				$.ajax({
					"dataType": 'json',
					"type": "post",
					"url": baseUrl + "order/cart/" + productId + "/" + sl,
					contentType: "application/json",
					headers: {
						"x-token": token,
						"type": 1
					},
					"data": {},
					"success": function(data) {
						if(data.code == 200) {
							alert("添加成功");
						}
					},
					"error": function(data) {
						if(data.status == 500) {
							alert("服务器异常");
						}
					}
				});
			}

			function addCart2(id) {
				$.ajax({
					"dataType": 'json',
					"type": "post",
					"url": baseUrl + "order/cart/" + id + "/1",
					contentType: "application/json",
					headers: {
						"x-token": token,
						"type": 1
					},
					"data": {},
					"success": function(data) {
						if(data.code == 200) {
							alert("添加成功");
						}
					},
					"error": function(data) {
						if(data.status == 500) {
							alert("服务器异常");
						}
					}
				});
			}
			// Can also be used with $(document).ready()
			$(window).load(function() {
				$('.flexslider').flexslider({
					animation: "slide",
					controlNav: "thumbnails"
				});
			});

			function abdc() {
				var sl = $('#shuliang').val();
				var rPrice = $('#rPrice').val();

				sl = parseInt(sl) + 1;
				$('#shuliang').val(sl);
				var p = new BigDecimal("" + sl).multiply(new BigDecimal("" + rPrice));
				$('#ccc').html("总价: " + p + "元");
			}

			function abdce() {
				var sl = $('#shuliang').val();
				var rPrice = $('#rPrice').val();
				if(sl > 1) {
					sl = parseInt(sl) - 1;
				}
				$('#shuliang').val(sl);
				var p = new BigDecimal("" + sl).multiply(new BigDecimal("" + rPrice));
				$('#ccc').html("总价: " + p + "元");
			}

			function abc() {
				var sl = $('#shuliang').val();
				var rPrice = $('#rPrice').val();
				if(sl > 1) {
					sl = parseInt(sl);
				} else {
					sl = 1
				}
				$('#shuliang').val(sl);
				var p = new BigDecimal("" + sl).multiply(new BigDecimal("" + rPrice));
				$('#ccc').html("总价: " + p + "元");
			}
		</script>
	</body>

</html>