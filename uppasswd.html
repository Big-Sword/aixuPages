<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>爱 煦 - 我的</title>
<!--
Holiday Template
http://www.templatemo.com/tm-475-holiday
-->
  <link href="css/font-awesome.min.css" rel="stylesheet">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet">  
  <link href="css/flexslider.css" rel="stylesheet">
  <link href="css/templatemo-style.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body class="tm-gray-bg">
  	<!-- Header -->
  	<div class="tm-header">
  		<div class="container">
  			<div class="row">
  				<div class="col-lg-6 col-md-4 col-sm-3 tm-site-name-container">
  					<a href="#" class="tm-site-name">爱 煦</a>	
  				</div>
	  			<div class="col-lg-6 col-md-8 col-sm-9">
	  				<div class="mobile-menu-icon">
		              <i class="fa fa-bars"></i>
		            </div>
	  				<nav class="tm-nav">
						<ul>
							<li><a href="index.html">首页</a></li>
							<!-- <li><a href="about.html">About</a></li> -->
							<li><a href="product.html">产品中心</a></li>
							<li>
									<a href="about.html">关于我们</a>
								</li>
								<li>
									<a href="#" id="loginhref"><span class="glyphicon glyphicon-user"></span> <span id="loginName"></span> <span class="caret"></span></a>
									<ul class="dropdown-menu" id="loginlogout" style="left: auto;width: 102px;">
										<li>
											<a href="cart.html" ><span class="glyphicon glyphicon-shopping-cart">我的购物车</span> </a>
										</li>
										<li>
											<a href="order.html" ><span class="glyphicon glyphicon-ok-circle"></span> 我的订单</a>
										</li>
										<li>
											<a href="uppasswd.html" ><span class="glyphicon glyphicon-edit"></span> 修改密码</a>
										</li>
										<li>
											<a href="#" onclick="logout()"><span class="glyphicon glyphicon-log-out"></span> 登出</a>
										</li>
									</ul>
								</li>
						</ul>
					</nav>		
	  			</div>				
  			</div>
  		</div>	  	
  	</div>
	
	<!-- white bg -->
	<section class="tm-white-bg section-padding-bottom" id="more">
		<div class="container">
			<div class="row">
				<div class="tm-section-header section-margin-top">
					<div class="col-lg-4 col-md-3 col-sm-3"><hr></div>
					<div class="col-lg-4 col-md-6 col-sm-6"><h2 class="tm-section-title">修改密码</h2></div>
					<div class="col-lg-4 col-md-3 col-sm-3"><hr></div>	
				</div>				
			</div>
						
			<div class="col-lg-2 col-md-1 col-sm-1"></div>
			<div class="col-lg-8 col-md-10 col-sm-10">
				<div class="modal-body">
					<div class="row">
						<div class="col-lg-12">
							<!-- <div class="panel panel-default"> -->
								<div class="panel-body">
									<table id="sample_3" class="table table-striped table-bordered" cellspacing="0" width="100%">
										<div style="text-align:center;height:30px;line-height:30px;" class="col-md-3 control-label" for="loginPassword1"><h5>请输入新密码</h5></div>
											<div class="col-md-7">
												<input id="loginPassword1" name="loginPassword1" type="password" class="form-control" placeholder="请输入6-20位新密码, 支持数字和字母">
												</div>
											</div>
										</div>
										
										<div class="col-md-12"><br></div>

										<div style="text-align:center;height:30px;line-height:30px;" class="col-md-3 control-label" for="loginPassword2"><h5>请确认新密码</h5></div>
											<div class="col-md-7">
												<input id="loginPassword2" name="loginPassword2" type="password" class="form-control" placeholder="请再次输入新密码">
												</div>
											</div>
										</div>
									</table>
									<br>
									<div style="margin:0 auto;width:200px;"> 
										<div class="btn-group btn-group-justified">
											<div class="btn-group">
												<button type="button" class="btn btn-default" onclick="updatePassword()">确定</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						<!-- </div> -->
					</div>
				</div>
			</div>
			<div class="col-lg-2 col-md-1 col-sm-1"></div>
			<!-- /.col-->
		</div>		
		</div>
	</section>
		<footer class="tm-black-bg">
			<div class="container">
				<div class="row">
					<p class="tm-copyright-text">Copyright &copy; 2084 爱煦
					</p>
				</div>
			</div>
		</footer>
	<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>      		<!-- jQuery -->
  	<script type="text/javascript" src="js/bootstrap.min.js"></script>					<!-- bootstrap js -->
  	<script type="text/javascript" src="js/jquery.flexslider-min.js"></script>			<!-- flexslider js -->
  	<script type="text/javascript" src="js/templatemo-script.js"></script>      		<!-- Templatemo Script -->
	<script>
	var baseUrl = "http://localhost:8080/";
	 // var baseUrl = "http://139.196.12.123:8080/";

		$(function() {

			// https://css-tricks.com/snippets/jquery/smooth-scrolling/
		  	$('a[href*=#]:not([href=#])').click(function() {
			    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
			      var target = $(this.hash);
			      target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
			      if (target.length) {
			        $('html,body').animate({
			          scrollTop: target.offset().top
			        }, 1000);
			        return false;
			      }
			    }
		  	});		  	
		});
		$(window).load(function(){
			// Flexsliders
		  	$('.flexslider.flexslider-banner').flexslider({
			    controlNav: false
		    });
		  	$('.flexslider').flexslider({
		    	animation: "slide",
		    	directionNav: false,
		    	slideshow: false
		  	});

			//临时调试用
		  	// $('#myModal').modal('show');
		});

		var storage = window.localStorage;
		var token = storage.shopperToken;
		var username = storage.shopperName;
		$(window).load(function() {	  		
			console.log(token)
			console.log(username)
			if(token == undefined || token == "null") {
					// location.href = "login.html";
					$("#loginhref").attr("href", "login.html"); //这里设置链接地址
		  			$("#loginhref").html("登录");  //这里设置显示的内容

		  			$("#loginlogout").hide();
				} else {
					//class="dropdown-toggle" data-toggle="dropdown"
					$("#loginhref").attr("class", "dropdown-toggle"); //这里设置链接
					$("#loginhref").attr("data-toggle", "dropdown"); //这里设置链接
					$("#loginName").html(storage.shopperName);
				}! function($) {
					$(document).on("click", "ul.nav li.parent > a > span.icon", function() {
						$(this).find('em:first').toggleClass("glyphicon-minus");
					});
					$(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
			}(window.jQuery);

//	For images only
		    $('.flexslider').flexslider({
			    controlNav: false
		    });
	  	});

	  	function logout() {
			storage.removeItem("shopperToken");
			storage.removeItem("shopperName");
			location.href = "index.html";
		}

			

			function updatePassword() {
				var loginPassword1 = $("#loginPassword1").val();
				var loginPassword2 = $("#loginPassword2").val();
				var reg = new RegExp("^[A-Za-z0-9]+$");

				if (loginPassword1.length == 0 || loginPassword2.length == 0) {
					alert("新密码或者确认密码不能为空");
					return;
				}else if (!reg.test(loginPassword1) || !reg.test(loginPassword2)){
					alert("密码只能由数字和字母组成");
					return;
				}else if ((loginPassword1.length>20 || loginPassword1.length<6) 
					|| (loginPassword2.length>20 || loginPassword2.length<6) ){
					alert("密码长度必须在 6 - 20 之间");
					return;
				}else if (loginPassword1 != loginPassword2) {
					alert("两次输入的密码不一致, 请检查您的输入");
					return;
				};

				$.ajax({
					contentType: "application/json",
					headers: {
						"x-token": storage.shopperToken,
						"type": 1
					},
					type: "post",
					dataType: "json",
					url: baseUrl + "shopper/updatePassword",
					data: JSON.stringify({
						"loginPassword": loginPassword1
					}),
					success: function(data) {
						if(data.code == 200) {
							alert("修改成功, 请重新登录");
							storage.removeItem("shopperToken");
							storage.removeItem("shopperName");
							location.href = "login.html";
						} else {
							alert(data.msg);
						}
					},
					"error": function(resp) {
						if(resp.status == 500) {
							alert("服务器异常");
						} else {
							//location.href = "about.html";
						}
					}
				});

			}
	</script>
 </body>
 </html>
