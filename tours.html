<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>爱 煦 - 产品中心</title>
<!--
Holiday Template
http://www.templatemo.com/tm-475-holiday
--><!-- 
  <link href='http://fonts.useso.com/css?family=Open+Sans:400,300,400italic,600,700' rel='stylesheet' type='text/css'> -->
  <link href="css/font-awesome.min.css" rel="stylesheet">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet"> 
  <link href="css/flexslider.css" rel="stylesheet"> 
  <link href="css/templatemo-style.css" rel="stylesheet">
  <link href="css2/jquery.datetimepicker.css" rel="stylesheet">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

</style>
</head>
  <body class="tm-gray-bg">
  	<!-- Header -->
  	<div class="tm-header">
  		<div class="container">
  			<div class="row">
  				<div class="col-lg-6 col-md-4 col-sm-3 tm-site-name-container">
  					<a href="#" class="tm-site-name">爱 煦</a>	
  				</div>
	  			<div class="col-lg-6 col-md-8 col-sm-9">
	  				<div class="mobile-menu-icon">
		              <i class="fa fa-bars"></i>
		            </div>
	  				<nav class="tm-nav">
						<ul>
							<li><a href="index.html">首页</a></li>
							<!-- <li><a href="about.html">About</a></li> -->
							<li><a href="tours.html" class="active">产品中心</a></li>
							<li><a href="contact.html">我的订单</a></li>
							<li>
							<a href="#" id="loginhref" ><span class="glyphicon glyphicon-user"></span> <span id="loginName"></span> <span class="caret"></span></a>
							<ul class="dropdown-menu" id="loginlogout">
								<li>
									<a href="#" onclick="logout()"><span class="glyphicon glyphicon-log-out"></span> 登出</a>
								</li>
							</ul>
						    </li>
						</ul>
					</nav>		
	  			</div>				
  			</div>
  		</div>	  	
  	</div>
	
	<!-- Banner -->
	<section class="tm-banner">
		<!-- Flexslider -->
		<div class="flexslider flexslider-banner">
		  <ul class="slides">
		    <li>
			    <div class="tm-banner-inner">
					<h1 class="tm-banner-title">Find <span class="tm-yellow-text">Tour</span> Programs</h1>
					<p class="tm-banner-subtitle">For Your Destinations</p>
					<a href="#more" class="tm-banner-link">Learn More</a>	
				</div>
		      <img src="img/banner-2.jpg" />
		    </li>
		    <li>
			    <div class="tm-banner-inner">
					<h1 class="tm-banner-title">Lorem <span class="tm-yellow-text">Ipsum</span> Dolor</h1>
					<p class="tm-banner-subtitle">Wonderful Destinations</p>
					<a href="#more" class="tm-banner-link">Learn More</a>	
				</div>
		      <img src="img/banner-3.jpg" />
		    </li>
		    <li>
			    <div class="tm-banner-inner">
					<h1 class="tm-banner-title">Proin <span class="tm-yellow-text">Gravida</span> Nibhvell</h1>
					<p class="tm-banner-subtitle">Velit Auctor</p>
					<a href="#more" class="tm-banner-link">Learn More</a>	
				</div>
		      <img src="img/banner-1.jpg" />
		    </li>
		  </ul>
		</div>			
	</section>
	
	
	<!-- white bg -->
	<section class="tm-white-bg section-padding-bottom" id="more">
		<div class="container">
			<div class="row">
				<div class="tm-section-header section-margin-top">
					<div class="col-lg-4 col-md-3 col-sm-3"><hr></div>
					<div class="col-lg-4 col-md-6 col-sm-6"><h2 class="tm-section-title">产品中心</h2></div>
					<div class="col-lg-4 col-md-3 col-sm-3"><hr></div>	
				</div>				
			</div>
			<div class="row">
				<div class="col-lg-12">
					<div class="panel panel-default">
						<div class="panel-body">
							<table id="sample_2" class="table table-striped table-bordered" cellspacing="0" width="100%">
								<thead>
									<tr>
										<th>产品名称</th>
										<th>产品图片</th>
										<th>产品内容</th>
										<th>型号</th>
										<th>色号</th>
										<th>单价</th>
										<th>操作</th>
									</tr>
								</thead>
							</table>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="tm-section-header section-margin-top">
					<div class="col-lg-4 col-md-3 col-sm-3"><hr></div>
					<div class="col-lg-4 col-md-6 col-sm-6"><h2 class="tm-section-title">购物车</h2></div>
					<div class="col-lg-4 col-md-3 col-sm-3"><hr></div>	
				</div>				
			</div>
			<div class='row'>
			  <div class='col-lg-12'>
				<div class='panel panel-default'>
				         <div class='panel-body'>
					        <table id='sample_3' class='table table-striped table-bordered' cellspacing='0' width="100%">
									<tr>
										<th>产品名称</th>
										<th>操作</th>
									</tr>
							</table>
						</div>
						<div class='panel-body'>
					         <p>
					           <div align="right">
                 	           <span>婚礼时间:<input type="text" class="testS" id="weddingTime" onclick="fullDate('weddingTime')"></span>
                 	           <span>送货时间:<input type="text" class="testS" id="deliveryTime" onclick="fullDate('deliveryTime')"></span>
                 	           <span><button type="button" onclick="createOrder()"  id = "createOrder" class="btn btn-primary">
                                    下单
                               </button></span>
                               </div>
                             </p>
			
						</div>
				 </div>
		     </div>
	       </div>

        
		</div>
		 	    
	</section>
	
	<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>      		<!-- jQuery -->
	<script type="text/javascript" src="js/bootstrap.min.js"></script>					<!-- bootstrap js -->
	<script type="text/javascript" src="js/jquery.flexslider-min.js"></script>			<!-- flexslider js -->

	<script src="js2/jdt.js"></script>
	<script src="js2/dtb.js"></script>
	<script src="js2/jquery.datetimepicker.full.js"></script>
	<script src="js/fnReloadAjax.js"></script>
	<script type="text/javascript" src="js/templatemo-script.js"></script>   
	<script>
		// HTML document is loaded. DOM is ready.
		var baseUrl = "http://139.196.12.123:8080/";
		var storage = window.localStorage;
		var token = storage.token;
		var username = storage.name;

		$(function() {
		
			// https://css-tricks.com/snippets/jquery/smooth-scrolling/
		  	$('a[href*=#]:not([href=#])').click(function() {
			    if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
			      var target = $(this.hash);
			      target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
			      if (target.length) {
			        $('html,body').animate({
			          scrollTop: target.offset().top
			        }, 1000);
			        return false;
			      }
			    }
		  	});	
		  	 
		});
        function minProduct(id) {
        	       var input = $("#"+id).next();
        	       var tempValue = parseInt($(input).val());
        	       if(isNaN(tempValue)) {
                     alert("数量输入框只能输入数字");
        	       }else {
               	   var value = tempValue-1;
                   if(value == 0) {
                   	 $("#"+id).parent().parent().parent().remove();
                   }else {
                   	 $(input).val(value);
                   }}
        }

        function increaseProduct(id) {
        	      var input = $("#"+id).prev(); 
        	      var tempValue = parseInt($(input).val());
        	       if(isNaN(tempValue)) {
                     alert("数量输入框只能输入数字");
        	       }else {
               	      var value = tempValue+1;
               	      $(input).val(value);
               	   }

        }

		function addProduct(id,name){
               	      var doc = $("#sample_3").find("#"+id);
               	      var minId = "min"+id;
               	      var increaseId = "increase"+id;
               	      if(doc.length == 0) {
               	          var newRow = "<tr id='"+id+"''><td>"+name+"</td><td><div align='center'><button id='"+minId+"' type='button' onclick='minProduct(\""+minId+"\")' class=' btn btn-default'>-</button> <input style='text-align:right' class='sy_num' size = '5' type='text' value='1' />&nbsp;<button type='button' id='"+increaseId+"' onclick='increaseProduct(\""+increaseId+"\")' class='btn btn-default'>+</button></div></td></tr>";
               	           $("#sample_3 tr:last").after(newRow);
               	      }

		 }
		 function logout() {
			storage.removeItem("token");
			storage.removeItem("name");
			location.href = "index.html";
		}
		 function DateToUnix(string) {
		 	var f = string.split(' ', 2);
								var d = (f[0] ? f[0] : '').split('-', 3);
								var t = (f[1] ? f[1] : '').split(':', 3);
								return(new Date(
									parseInt(d[0], 10) || null,
									(parseInt(d[1], 10) || 1) - 1,
									parseInt(d[2], 10) || null,
									parseInt(t[0], 10) || null,
									parseInt(t[1], 10) || null,
									parseInt(t[2], 10) || null
								)).getTime() / 1000;
		 }
		 function createOrder(){
                if(confirm("确定要下单吗？")) {
                     var size = $("#sample_3").find("tr").length;
                     if(size <=1) {
                     	alert("您还没有购买商品");
                     }else {
					     $("#createOrder").attr("disabled", true);
					     var list = [];//数组
                         for(var i = 1;i<size;i++) {
                         	var productId = $("#sample_3 tr:eq('"+i+"')").attr("id");
                         	var productNum = $("#sample_3 tr:eq('"+i+"')").find(".sy_num").val();
                         	var weddingTime = DateToUnix($("#weddingTime").val());
                         	var deliveryTime = DateToUnix($("#deliveryTime").val());
                         	
                         	if(isNaN(productNum)) {
                         		alert("数量输入框只能是数字");
                                $("#createOrder").attr("disabled", false);
                         		return;
                         	}
                         	if(weddingTime == undefined || weddingTime =="") {
                         		alert("婚礼时间不能为空");
                         		$("#createOrder").attr("disabled", false);
                         		$("#weddingTime").focus();

                         		return;
                         	}
                         	if(deliveryTime == undefined || deliveryTime =="") {
                         		alert("婚礼时间不能为空");
                         		$("#createOrder").attr("disabled", false);
                         		$("#deliveryTime").focus();
                         		return;
                         	}
                         	
                                list[i-1] = {"productId":parseInt(productId),"productNum":parseInt(productNum)};
                         	
                         }
              

					    $.ajax({
						
							type: "post",
							url: baseUrl+"order/ordering",
							async: false,
							contentType: "application/json",
							headers: {
								"x-token": token
							},
							data: JSON.stringify({"orderDetailItems":list,"weddingTime":weddingTime,"deliveryTime":deliveryTime}),
							success: function(data) {
								if(data.code == 200) {
									alert("下单成功");
									$("#sample_3").find("tr[id]").remove();	
									$("#weddingTime").val("");
									$("#deliveryTime").val("");
								} else {
									alert(data.msg);
								}
							},
							error: function(resp) {
								if(resp.status == 500) {
									alert("服务器异常");
								} else {
									location.href = "about.html";
								}
							}
						});
						$("#createOrder").attr("disabled", false);
					 }
                }
		 }

		
		// Load Flexslider when everything is loaded.
		$(window).load(function() {	  		
		    $('.flexslider').flexslider({
			    controlNav: false
		    });
            console.log(token)
			console.log(username)
			if(token == undefined || token == "null") {
					// location.href = "login.html";
					$("#loginhref").attr("href", "about.html"); //这里设置链接地址
		  			$("#loginhref").html("登录");  //这里设置显示的内容

		  			$("#loginlogout").hide();
				} else {
					//class="dropdown-toggle" data-toggle="dropdown"
					$("#loginhref").attr("class", "dropdown-toggle"); //这里设置链接
					$("#loginhref").attr("data-toggle", "dropdown"); //这里设置链接
					$("#loginName").html(storage.name);
				}! function($) {
					$(document).on("click", "ul.nav li.parent > a > span.icon", function() {
						$(this).find('em:first').toggleClass("glyphicon-minus");
					});
					$(".sidebar span.icon").find('em:first').addClass("glyphicon-plus");
			}(window.jQuery);

            var TableManaged = function() {
					return {
						// main function to initiate the moduleda
						init: function() {
							console.log(1111)
							if(!jQuery().dataTable) {
								return;
							}

							$('#sample_2')
								.dataTable({
									// set the initial value
									"ordering": false,
									"oLanguage": {
										"sLengthMenu": "每页显示 _MENU_ 条记录",
										"sInfo": "共 _TOTAL_ 条数据",
										"sZeroRecords": "抱歉， 没有找到(只搜商品名称哦)",
										"sInfoEmpty": "没有数据",
										"sInfoFiltered": "(从 _MAX_ 条数据中检索)",
										"sSearch": "搜索商品名称",
										"sInfo": "当前 _START_ 到 _END_ /共_TOTAL_条数据 ",
										"oPaginate": {
											"sPrevious": "前页",
											"sNext": "后页",
										}
									},
									"bStateSave": true,
									// "bProcessing" : true,
									"bServerSide": true,
									"sAjaxSource": baseUrl+"product/all",
									"fnServerData": function(sSource,
										aoData, fnCallback) {
										$.ajax({
											"dataType": 'json',
											"type": "post",
											"url": baseUrl+"product/all",
											contentType: "application/json",
											headers: {
												"x-token": token
											},
											"data": {
												aoData: JSON
													.stringify(aoData)
											},
											"success": function(resp) {
												fnCallback(resp);
											},
											"error": function(resp) {
												if(resp.status == 500) {
													alert("服务器异常");
												} else {
													location.href = "about.html";
												}
											}
										});
									},
									"aoColumns": [{
										"mData": "name"
									}, {
										"mData": null,
									}, {
										"mData": "content"
									}, {
										"mData": "model_type"
									}, {
										"mData": "colour_type"
									}, {
										"mData": "price"
									}, {
										"mData": null
									}],
									"aoColumnDefs": [{
										'bSortable': false,
										'aTargets': [6],
										"mRender": function(data,
											type, full) {

											return "<button class='btn btn-primary' onclick='addProduct("+full.id+",\""+full.name+"\")'>加入购物车</button>";
										}
									}, {
										'bSortable': false,
										'aTargets': [1],
										"mRender": function(data,
											type, full) {
											var picUrls = full.pic_url.split("~");
											var html = "";
											for(var i = 0; i < picUrls.length; i++) {
												html += "<a href=\"productImg/" + picUrls[i] + "\" target=\"_blank\"><img src=\"productImg/" + picUrls[i] + "\"  width='40' height='40'/></a>&nbsp;&nbsp;";
												
											}
											return "<div>" + html + "</div>";
										}
									}]
								
							});
						}

					};

				}();

				TableManaged.init();

				

              
	  	}); 

            var logic = function(currentDateTime) {
					if(currentDateTime && currentDateTime.getDay() == 6) {
						this.setOptions({
							minTime: '11:00'
						});
					} else
						this.setOptions({
							minTime: '8:00'
						});
				}
            $.datetimepicker.setLocale('ch'); //设置中文
			function fullDate(id) {}
				$('.testS').datetimepicker({
					onChangeDateTime: logic,
					onShow: logic
				});
				
              
	</script>
 </body>
 </html>
